<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/lc/western/julian.js | @drewsonne/maya-dates</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Node.js package to represent dates in the Maya Calendar"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="@drewsonne/maya-dates"><meta property="twitter:description" content="Node.js package to represent dates in the Maya Calendar"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/full-date.js~FullDate.html">FullDate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/wildcard.js~Wildcard.html">Wildcard</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#cr">cr</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cr/calendar-round.js~CalendarRound.html">CalendarRound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cr/haab-month.js~HaabMonth.html">HaabMonth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cr/haab.js~Haab.html">Haab</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cr/tzolkin-day.js~TzolkinDay.html">TzolkinDay</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cr/tzolkin.js~Tzolkin.html">Tzolkin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCalendarRound">getCalendarRound</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getHaabMonth">getHaabMonth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getHaab">getHaab</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTzolkinDay">getTzolkinDay</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTzolkin">getTzolkin</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#factory">factory</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/factory/base.js~Factory.html">Factory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/factory/calendar-round.js~CalendarRoundFactory.html">CalendarRoundFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/factory/full-date.js~FullDateFactory.html">FullDateFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/factory/long-count.js~LongCountFactory.html">LongCountFactory</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#lc">lc</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/lc/correlation-constant.js~CorrelationConstant.html">CorrelationConstant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/lc/long-count.js~LongCount.html">LongCount</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCorrelationConstant">getCorrelationConstant</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#lc-night">lc/night</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/lc/night/lord-of-night.js~LordOfNight.html">LordOfNight</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get">get</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#operations">operations</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/operations/calendar-round-wildcard.js~CalendarRoundWildcard.html">CalendarRoundWildcard</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/operations/fulldate-wildcard.js~FullDateWildcard.html">FullDateWildcard</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/operations/longcount-addition.js~LongcountAddition.html">LongcountAddition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/operations/longcount-subtraction.js~LongcountSubtraction.html">LongcountSubtraction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/operations/longcount-wildcard.js~LongCountWildcard.html">LongCountWildcard</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/lc/western/julian.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">const moonbeams = require(&apos;moonbeams&apos;);
const WesternCalendar = require(&apos;./western&apos;);

// const moment = require(&apos;moment-timezone&apos;);

class JDate {
  constructor(year, month, date) {
    this._gregorian_date = [year, month, date];
    this.year = undefined;
    this.month = undefined;
    this.day = undefined;

    this.month_day_mapping = {
      1: 31,
      3: 31,
      4: 30,
      5: 31,
      6: 30,
      7: 31,
      8: 31,
      9: 30,
      10: 31,
      11: 30,
      12: 31,
    };

    this.direction = (this.year &lt; 0) ? -1 : 1;
  }

  normalize() {
    this.year = this._gregorian_date[0];
    this.month = this._gregorian_date[1];
    this.day = this._gregorian_date[2];

    this.day += this.julian_offset();

    this.normalize_month_day();
    return this;
  }

  normalize_month_day() {
    let days_in_month = this.daysInMonth(this.month);
    if (this.day &gt; days_in_month) {
      let overflow = this.day - days_in_month;
      this.month += (this.direction * 1);
      this.day = overflow;
    } else if (this.day &lt; 1) {
      this.month -= 1;
      this.day = this.daysInMonth(this.month) + this.day;
    }

    if (this.month &gt; 12) {
      let overflow_months = this.month - 12;
      this.year += (this.direction * 1);
      this.month = overflow_months;
    }
  }

  daysInMonth(monday_num) {
    if (this.month === 2) {
      return this.isLeapYear() ? 29 : 28;
    }
    return this.month_day_mapping[this.month];
  }

  isLeapYear() {
    return (this.year % 4) === 0;
  }

  julian_offset() {
    let date_number = parseInt(
      this.toString().split(&apos;/&apos;).reverse().join(&apos;&apos;)
    );
    if (date_number &lt;= 0) {
      if (date_number &lt; -2000000) {
        return 4;
      } else if (date_number &gt; -1000301) {
        return 3;
      } else {
        return 2;
      }
    } else if (date_number &lt;= 1000228) {
      return 2;
    } else if (date_number &lt;= 2000228) {
      return 1;
    } else if (date_number &lt;= 3000228) {
      return 0;
    } else if (date_number &lt;= 3000302) {
      return -1;
    } else if (date_number &lt;= 5000303) {
      return -2;
    } else if (date_number &lt;= 6000304) {
      return -3;
    } else if (date_number &lt;= 7000305) {
      return -4;
    } else if (date_number &lt;= 9000306) {
      return -5;
    } else if (date_number &lt;= 10000307) {
      return -6;
    } else if (date_number &lt;= 11000308) {
      return -7;
    } else if (date_number &lt;= 13000309) {
      return -8;
    } else if (date_number &lt;= 14000310) {
      return -9;
    } else if (date_number &lt;= 17000228) {
      return -10;
    } else if (date_number &lt;= 18000228) {
      return -11;
    } else if (date_number &lt;= 19000228) {
      return -12;
    } else if (date_number &lt;= 21000228) {
      return -13;
    } else if (date_number &lt;= 21000314) {
      return -14;
    }
    return 0;
  }

  toString() {
    let year = this.year.toString();
    let month = this.month.toString();
    let day = this.day.toString();
    if (year.length &lt; 4) {
      year = `0${year}`;
    }

    if (month.length &lt; 2) {
      month = `0${month}`;
    }

    if (day.length &lt; 2) {
      day = `0${day}`;
    }

    return `${day}/${month}/${year}`;
  }
}

function julianFromGregorian(gregorian_date) {
  return new JDate(
    gregorian_date.year,
    gregorian_date.month,
    Math.floor(gregorian_date.day),
  ).normalize();
}


class JulianCalendarDate extends WesternCalendar {
  constructor(julianDay) {
    super(julianDay, JulianCalendarDate);
    this.date = julianFromGregorian(
      moonbeams.jdToCalendar(julianDay)
    );
  }
}

module.exports = JulianCalendarDate;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
